{% extends "base.html" %}
{% block title %}Forgot Password - HealthCare+{% endblock %}

{% block content %}
<div class="auth-wrapper-modern">
    <div class="auth-card-modern">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="fw-bold text-primary">HealthCare+</h1>
            <p class="text-muted small">Securely reset your password in just a few steps</p>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else ('check-circle' if category == 'success' else 'info-circle') }} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Step 1: Enter Mobile Number -->
        {% if step == 'enter_number' %}
        <form method="POST" action="{{ url_for('patient.forgot_password') }}" class="needs-validation" novalidate>
            <div class="form-floating mb-4">
                <input type="tel" class="form-control form-control-lg" id="mobile_number" name="mobile_number" placeholder="Mobile Number" required pattern="\d{10}">
                <label for="mobile_number"><i class="fas fa-mobile-alt me-2"></i>Mobile Number</label>
                <div class="invalid-feedback">Please enter a valid 10-digit mobile number.</div>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-sm btn-gradient">
                    <i class="fas fa-paper-plane me-2"></i>Send Verification Code
                </button>
            </div>
        </form>
        {% endif %}

        <!-- Step 2: Enter 6-digit Code -->
        {% if step == 'enter_code' %}
        <form method="POST" action="{{ url_for('patient.forgot_password') }}" class="needs-validation" novalidate>
            <input type="hidden" name="mobile_number" value="{{ mobile_number }}">
            <div class="form-floating mb-4">
                <input type="text" class="form-control form-control-lg" name="verification_code" placeholder="6-digit Code" required pattern="\d{6}">
                <label><i class="fas fa-key me-2"></i>Enter 6-digit Code</label>
                <div class="invalid-feedback">Enter the 6-digit code sent to your email.</div>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-sm btn-gradient">
                    <i class="fas fa-check me-2"></i>Verify Code
                </button>
            </div>
        </form>
        {% endif %}

        <!-- Step 3: Reset Password -->
        {% if step == 'reset_password' %}
        <form method="POST" action="{{ url_for('patient.forgot_password') }}" class="needs-validation" novalidate>
            <input type="hidden" name="mobile_number" value="{{ mobile_number }}">
            <div class="form-floating mb-3">
                <input type="password" class="form-control form-control-lg" name="password" placeholder="New Password" required minlength="6">
                <label><i class="fas fa-lock me-2"></i>New Password</label>
            </div>
            <div class="form-floating mb-4">
                <input type="password" class="form-control form-control-lg" name="confirm_password" placeholder="Confirm Password" required minlength="6">
                <label><i class="fas fa-check-circle me-2"></i>Confirm Password</label>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg fw-bold shadow-sm btn-gradient">
                    <i class="fas fa-sync-alt me-2"></i>Update Password
                </button>
            </div>
        </form>
        {% endif %}

        <!-- Back to login -->
        <div class="text-center mt-4">
            <a href="{{ url_for('patient.patient_login') }}" class="small text-decoration-none text-primary hover-underline">
                <i class="fas fa-arrow-left me-2"></i>Back to Login
            </a>
        </div>
    </div>

    <!-- Floating abstract shapes -->
    <div class="bg-shape shape1"></div>
    <div class="bg-shape shape2"></div>
    <div class="bg-shape shape3"></div>
</div>

<style>
/* Background */
.auth-wrapper-modern {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 2rem;
    background: #f0f4f8;
    overflow: hidden;
}

/* Floating abstract shapes */
.bg-shape {
    position: absolute;
    border-radius: 50%;
    opacity: 0.15;
    animation: floatShape 8s ease-in-out infinite alternate;
}
.shape1 { width: 200px; height: 200px; background: #4facfe; top: -50px; left: -50px; }
.shape2 { width: 300px; height: 300px; background: #00f2fe; bottom: -100px; right: -80px; }
.shape3 { width: 150px; height: 150px; background: #43e97b; top: 200px; right: -50px; }

@keyframes floatShape {
    0% { transform: translateY(0px) translateX(0px); }
    50% { transform: translateY(20px) translateX(15px); }
    100% { transform: translateY(-10px) translateX(-10px); }
}

/* Glassmorphism card */
.auth-card-modern {
    position: relative;
    width: 100%;
    max-width: 480px;
    padding: 2.5rem;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    z-index: 2;
    animation: slideUp 0.7s ease;
}

/* Floating labels & inputs */
.form-control {
    border-radius: 10px;
    height: 60px;
    font-size: 1rem;
}
.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}

/* Buttons with gradient */
.btn-gradient {
    background: linear-gradient(90deg, #007bff, #6610f2);
    color: #fff;
    transition: all 0.3s ease;
}
.btn-gradient:hover {
    background: linear-gradient(90deg, #6610f2, #007bff);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
}

/* Slide-up animation */
@keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* Hover underline for links */
.hover-underline:hover {
    text-decoration: underline;
}
</style>
{% endblock %}
